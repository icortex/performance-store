<%= javascript_include_tag "jquery.tokeninput" %>
<!-- TODO *************   Edit id   *********** -->
<%= render 'sales_form_js', :iva => Variable.find(1).value %>
<%= javascript_include_tag "nested_fields" %>

<%= form_for(@sale) do |f| %>
    <% if @sale.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@sale.errors.count, "error") %> prohibited this sale from being saved:</h2>

          <ul>
            <% @sale.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
    <% end %>

    <%= f.label 'Cliente' %>
    <div style="width:400px">
      <%= f.text_field :person_id %>
      <%= javascript_tag 'autocomplete_client();' %>
    </div>
    <br/>
    <table id='productsTable'>
      <th>Articulo</th>
      <th>Talla</th>
      <th>Color</th>
      <th>Precio</th>
      <th>Cantidad</th>
      <th>En stock</th>
      <th>Subtotal</th>
      <th>Quitar</th>
      <%= f.fields_for :sale_products do |b| %>
          <tr class="fields">
            <%= render :partial => 'sale_products_fields', :locals => {:f => b} %>
          </tr>
      <% end %>
      <tr id='add_product'>
        <td>
          <% index=0 %>
          <% for sp in @sale.sale_products do %>
              <%= javascript_tag "autocomplete_product(\"#sale_sale_products_attributes_#{index}\","+
                                                      "\"#{sp.product.brand.brand rescue ''}\","+
                                                      "\"#{sp.product.reference rescue ''}\","+
                                                      "\"#{sp.product.size.size rescue ''}\","+
                                                      "\"#{sp.product.color.color rescue ''}\","+
                                                      "products[#{index}]);" %>
              <% index+=1 %>
          <% end %>
          <%= link_to_add_fields image_tag('add.png', :title => 'Agregar articulo'), f, :sale_products %>
        </td>
      </tr>
    </table>

    <table class="form_class">

      <tr>
        <td>
          <%= f.label 'Descuento (%)' %>
        </td>
        <td>
          <input type="text" size="30px" id='discount_percentage'>
        </td>
      </tr>
      <tr>
        <td>
          <%= f.label 'Descuento' %>
        </td>
        <td>
          <%= f.text_field :discount %>
        </td>
      </tr>
      <tr>
        <td>
          <%= f.label 'Razon del descuento' %>
        </td>
        <td>
          <%= f.text_field :discount_reason %>
        </td>
      </tr>
      <tr>
        <td>
          <%= f.label 'IVA' %>
        </td>
        <td>
          <%= f.text_field :iva %>
        </td>
      </tr>
      <tr>
        <td>
          <%= f.label 'Total' %>
        </td>
        <td>
          <%= f.text_field :total %>
        </td>
      </tr>
    </table>
    <br/>
    <div class="actions">
      <%= f.submit 'Aceptar' %>
    </div>
<% end %>

<%= javascript_tag 'calculator_handlers();' %>